<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>

<style type="text/css">
		
	.snake-body {
		background-color: black;
	}

	.snake-food {
		background-color: blue;
	}

</style>

<script type="text/javascript">
	
	class Snake {

		constructor () {

			this.body = [

				{x: 0, y: 0}, // <- TAIL
				{x: 1, y: 0},
				{x: 2, y: 0},
				{x: 3, y: 0}  // <- HEAD
			];

			this.walkingTo = 'down';
		}

		to (direction) {

			if (this.isValidMove(direction) ) {
				this.walkingTo = direction;
			}
		}


		isValidMove (direction) {

			return !(  (direction === 'right' && this.walkingTo === 'left') ||
	 				   (direction === 'left' && this.walkingTo === 'right') ||
	 				   (direction === 'up' && this.walkingTo === 'down')    ||
	 				   (direction === 'down' && this.walkingTo === 'up') );
		}

		head () {

			const head = this.body[this.body.length - 1];
			return JSON.parse( JSON.stringify ( head ));  // clone object
		}

		tail () {

			const tail = this.body[0];
			return JSON.parse( JSON.stringify ( tail ));  // clone object
		}

		found (food) {
			
			const head = this.head();
			return (head.x === food.x && head.y === food.y);
		}

		eat (food) {

			this.body.unshift( this.tail() );
		}

		move () {

			this.body.shift();
			const head = this.head();

			switch (this.walkingTo) {

				case 'down':
					this.body.push( { x: ++head.x, y: head.y } );  break;

				case 'up':
					this.body.push( { x: --head.x, y: head.y } );  break;

				case 'right':
					this.body.push( { x: head.x, y: ++head.y } );  break;

				case 'left':
					this.body.push( { x: head.x, y: --head.y } );  break;
			}
		}
	}



	class Engine {

		constructor () {

			this.board = new Board(50, 40);
			this.loopInterval = 100;
			this.ui = null;
		}

		setUI (BoardUIClass) {
			this.ui = new BoardUIClass(this.board);

		}

		run () {

			const self = this;

			setInterval(function () {
				self.board.tick()
				if (self.ui) {
					self.ui.draw();
				}

			}, this.loopInterval);
		}
	}


	class Board {

		constructor (lines, columns) {

			this.snake = new Snake();
			this.lines = lines;
			this.columns = columns;
			this.loopInterval = 100;
			this.plant();
		}

		tick () {

			if (this.snake.found (this.food) ) {
				this.snake.eat(this.food);
				this.plant();
			}
			this.snake.move();
		}

		plant () {

			const x = Math.floor( Math.random() * this.lines ) + 0;
			const y = Math.floor( Math.random() * this.columns ) + 0;
			this.food = { x: x, y: y };

		}
	}


	class BoardConsoleUI {


	}

	class BoardBrowserUI {


		constructor (board) {
			this.board = board;
			this.createTable();
		}

		createTable () {

			const table = document.createElement('table');
			table.setAttribute('width', 600);
			table.setAttribute('height', 600);
			table.setAttribute('border', 1);
			
			for (let line = 0; line <= this.board.lines; line++) {
				let tr = document.createElement('tr');
				for (let column = 0; column <= this.board.columns; column++) {

					let td = document.createElement('td');
					td.setAttribute('data-x', line);
					td.setAttribute('data-y', column);
					td.setAttribute('data-coordinate', '');
					tr.appendChild(td);

				}

				table.appendChild(tr);
			}

			document.body.appendChild(table);
		}

		draw () {

			for (let td of document.querySelectorAll('td')) {
				td.className = '';
			}

			for (let square of this.board.snake.body) {

				let x = '[data-x="' + square.x + '"]';
				let y = '[data-y="' + square.y + '"]';
				let bodyItem = document.querySelector('td' + x + y);
				bodyItem.className = 'snake-body';
			}

			const x = '[data-x="' + this.board.food.x + '"]';
			const y = '[data-y="' + this.board.food.y + '"]';
			const foodItem = document.querySelector('td' + x + y);
			foodItem.className = 'snake-food';
		}
	}








	function main () {

		const engine = new Engine();
		engine.setUI(BoardBrowserUI);
		engine.run();

		document.body.addEventListener("keydown", (event) => {

			switch (event.keyCode) {
				case 40:
					engine.board.snake.to('down'); break;
				case 38:
					engine.board.snake.to('up'); break;
				case 39:
					engine.board.snake.to('right'); break;
				case 37:
					engine.board.snake.to('left'); break;
			}
		});
	}

	main();


</script>

</body>
</html>